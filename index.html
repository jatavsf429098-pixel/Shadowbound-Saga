<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmic Explorer: The Last Hope</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            overflow: hidden;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: #fff;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        #gameContainer {
            position: relative;
            width: 100%;
            height: 100%;
        }
        
        #canvasContainer {
            width: 100%;
            height: 100%;
        }
        
        #uiOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .logo {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(45deg, #00dbde, #fc00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
        }
        
        .stats {
            display: flex;
            gap: 20px;
        }
        
        .stat-box {
            background: rgba(0, 0, 0, 0.4);
            padding: 10px 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-width: 120px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #4deeea;
        }
        
        .stat-label {
            font-size: 14px;
            color: #aaa;
        }
        
        .story-panel {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            max-width: 800px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 30px rgba(0, 195, 255, 0.3);
            pointer-events: auto;
        }
        
        .story-title {
            font-size: 22px;
            margin-bottom: 10px;
            color: #4deeea;
            text-align: center;
        }
        
        .story-text {
            font-size: 16px;
            line-height: 1.6;
            text-align: center;
        }
        
        .controls {
            position: absolute;
            bottom: 30px;
            right: 30px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            pointer-events: auto;
        }
        
        .controls h3 {
            margin-bottom: 15px;
            color: #4deeea;
            text-align: center;
        }
        
        .key {
            display: inline-block;
            background: rgba(255, 255, 255, 0.1);
            padding: 5px 10px;
            border-radius: 5px;
            margin: 0 3px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle, #0f0c29, #1a1a2e);
            z-index: 20;
            pointer-events: auto;
        }
        
        .title {
            font-size: 60px;
            font-weight: 800;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #00dbde, #fc00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(0, 219, 222, 0.5);
        }
        
        .subtitle {
            font-size: 24px;
            margin-bottom: 40px;
            color: #aaa;
            text-align: center;
            max-width: 600px;
            line-height: 1.6;
        }
        
        .btn {
            background: linear-gradient(45deg, #00dbde, #fc00ff);
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            color: white;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 0 20px rgba(0, 219, 222, 0.5);
            transition: all 0.3s ease;
            pointer-events: auto;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 25px rgba(0, 219, 222, 0.7);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .character-select {
            display: flex;
            gap: 30px;
            margin: 40px 0;
        }
        
        .character-card {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 20px;
            width: 200px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .character-card:hover {
            transform: translateY(-10px);
            border-color: #4deeea;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .character-card.selected {
            border-color: #4deeea;
            background: rgba(77, 238, 234, 0.1);
            box-shadow: 0 0 20px rgba(77, 238, 234, 0.5);
        }
        
        .character-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }
        
        .character-name {
            font-size: 20px;
            margin-bottom: 10px;
            color: #4deeea;
        }
        
        .character-desc {
            font-size: 14px;
            color: #aaa;
        }
        
        .loading {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle, #0f0c29, #1a1a2e);
            z-index: 15;
            flex-direction: column;
        }
        
        .spinner {
            width: 80px;
            height: 80px;
            border: 8px solid rgba(255, 255, 255, 0.1);
            border-top: 8px solid #4deeea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 24px;
            color: #4deeea;
        }
        
        .mission-complete {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.8);
            z-index: 25;
            flex-direction: column;
        }
        
        .mission-title {
            font-size: 50px;
            margin-bottom: 20px;
            color: #4deeea;
            text-shadow: 0 0 20px rgba(77, 238, 234, 0.7);
        }
        
        .mission-text {
            font-size: 24px;
            margin-bottom: 40px;
            text-align: center;
            max-width: 800px;
            line-height: 1.6;
        }
        
        @media (max-width: 768px) {
            .title {
                font-size: 40px;
            }
            
            .subtitle {
                font-size: 18px;
                padding: 0 20px;
            }
            
            .character-select {
                flex-direction: column;
                align-items: center;
            }
            
            .story-panel {
                width: 90%;
                bottom: 10px;
            }
            
            .controls {
                bottom: 10px;
                right: 10px;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="canvasContainer"></div>
        
        <div id="uiOverlay">
            <div class="header">
                <div class="logo">COSMIC EXPLORER</div>
                <div class="stats">
                    <div class="stat-box">
                        <div class="stat-value" id="health">100%</div>
                        <div class="stat-label">HULL INTEGRITY</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="fuel">85%</div>
                        <div class="stat-label">FUEL</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="score">0</div>
                        <div class="stat-label">SCORE</div>
                    </div>
                </div>
            </div>
            
            <div class="story-panel">
                <div class="story-title">MISSION BRIEFING</div>
                <div class="story-text" id="storyText">
                    You are Captain Zara, humanity's last hope. The Earth is dying from cosmic radiation. 
                    Your mission: collect the 7 Quantum Crystals scattered across the galaxy to power the Terraforming Shield.
                </div>
            </div>
            
            <div class="controls">
                <h3>CONTROLS</h3>
                <p>Move: <span class="key">W</span> <span class="key">A</span> <span class="key">S</span> <span class="key">D</span></p>
                <p>Boost: <span class="key">SHIFT</span></p>
                <p>Fire: <span class="key">SPACE</span></p>
                <p>Rotate: Mouse</p>
            </div>
        </div>
        
        <div class="start-screen" id="startScreen">
            <div class="title">COSMIC EXPLORER</div>
            <div class="subtitle">
                Humanity's fate rests in your hands. Navigate through asteroid fields, 
                battle alien forces, and collect the Quantum Crystals to save Earth.
            </div>
            
            <div class="character-select">
                <div class="character-card selected" data-character="zara">
                    <div class="character-icon">👩‍🚀</div>
                    <div class="character-name">Captain Zara</div>
                    <div class="character-desc">Balanced pilot with strong shields</div>
                </div>
                <div class="character-card" data-character="rex">
                    <div class="character-icon">👨‍🚀</div>
                    <div class="character-name">Commander Rex</div>
                    <div class="character-desc">High speed and firepower</div>
                </div>
                <div class="character-card" data-character="nova">
                    <div class="character-icon">👩‍🔬</div>
                    <div class="character-name">Dr. Nova</div>
                    <div class="character-desc">Advanced tech and energy weapons</div>
                </div>
            </div>
            
            <button class="btn" id="startButton">BEGIN MISSION</button>
        </div>
        
        <div class="loading" id="loadingScreen">
            <div class="spinner"></div>
            <div class="loading-text">INITIALIZING QUANTUM DRIVE...</div>
        </div>
        
        <div class="mission-complete" id="missionComplete">
            <div class="mission-title">MISSION ACCOMPLISHED!</div>
            <div class="mission-text">
                Congratulations, Captain! You've collected all 7 Quantum Crystals and saved Earth from cosmic radiation. 
                Humanity can now begin the terraforming process. Your name will be remembered in history as the savior of our species.
            </div>
            <button class="btn" id="restartButton">NEW MISSION</button>
        </div>
    </div>

    <script>
        // Game variables
        let scene, camera, renderer, controls;
        let ship, asteroids = [], crystals = [], enemies = [];
        let keys = {};
        let gameStarted = false;
        let health = 100;
        let fuel = 100;
        let score = 0;
        let collectedCrystals = 0;
        let totalCrystals = 7;
        let selectedCharacter = 'zara';
        
        // Story segments
        const storySegments = [
            "You are Captain Zara, humanity's last hope. The Earth is dying from cosmic radiation. Your mission: collect the 7 Quantum Crystals scattered across the galaxy to power the Terraforming Shield.",
            "Approaching the first crystal sector. Watch out for asteroid fields and hostile alien patrols.",
            "First crystal acquired! Energy levels increasing. Three more sectors to explore.",
            "Warning: Enemy fighters detected. Prepare for combat!",
            "Second crystal secured. Hull integrity at 85%. Proceeding to the nebula sector.",
            "Navigating through the cosmic storm. Energy readings are fluctuating.",
            "Final crystal collected! Initiating return sequence to Earth. Mission complete!"
        ];
        
        // Initialize the game
        function init() {
            // Create scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000022);
            scene.fog = new THREE.Fog(0x000022, 100, 1000);
            
            // Create camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
            camera.position.set(0, 5, 15);
            
            // Create renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.getElementById('canvasContainer').appendChild(renderer.domElement);
            
            // Add lighting
            const ambientLight = new THREE.AmbientLight(0x333333);
            scene.add(ambientLight);
            
            const sunLight = new THREE.DirectionalLight(0xffffff, 1);
            sunLight.position.set(5, 10, 7);
            sunLight.castShadow = true;
            scene.add(sunLight);
            
            // Create stars background
            createStars();
            
            // Create player ship
            createShip();
            
            // Create asteroids
            createAsteroids();
            
            // Create crystals
            createCrystals();
            
            // Create enemies
            createEnemies();
            
            // Add event listeners
            window.addEventListener('resize', onWindowResize);
            document.addEventListener('keydown', (e) => keys[e.key.toLowerCase()] = true);
            document.addEventListener('keyup', (e) => keys[e.key.toLowerCase()] = false);
            
            // Character selection
            document.querySelectorAll('.character-card').forEach(card => {
                card.addEventListener('click', () => {
                    document.querySelectorAll('.character-card').forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                    selectedCharacter = card.dataset.character;
                });
            });
            
            // Start button
            document.getElementById('startButton').addEventListener('click', startGame);
            
            // Restart button
            document.getElementById('restartButton').addEventListener('click', restartGame);
            
            // Hide loading screen
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
            }, 2000);
            
            // Start animation loop
            animate();
        }
        
        // Create starfield background
        function createStars() {
            const starGeometry = new THREE.BufferGeometry();
            const starMaterial = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 0.2,
                transparent: true
            });
            
            const starVertices = [];
            for (let i = 0; i < 10000; i++) {
                const x = (Math.random() - 0.5) * 2000;
                const y = (Math.random() - 0.5) * 2000;
                const z = (Math.random() - 0.5) * 2000;
                starVertices.push(x, y, z);
            }
            
            starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
            const stars = new THREE.Points(starGeometry, starMaterial);
            scene.add(stars);
        }
        
        // Create player ship
        function createShip() {
            const shipGeometry = new THREE.ConeGeometry(1, 3, 8);
            const shipMaterial = new THREE.MeshPhongMaterial({ 
                color: 0x00aaff,
                shininess: 100,
                emissive: 0x0044aa
            });
            
            ship = new THREE.Mesh(shipGeometry, shipMaterial);
            ship.rotation.x = Math.PI;
            ship.castShadow = true;
            scene.add(ship);
            
            // Add engine glow
            const engineGeometry = new THREE.SphereGeometry(0.5, 16, 16);
            const engineMaterial = new THREE.MeshBasicMaterial({ 
                color: 0xff5500,
                transparent: true,
                opacity: 0.7
            });
            
            const engine = new THREE.Mesh(engineGeometry, engineMaterial);
            engine.position.z = -1.5;
            ship.add(engine);
        }
        
        // Create asteroids
        function createAsteroids() {
            const asteroidGeometry = new THREE.DodecahedronGeometry(1, 0);
            const asteroidMaterial = new THREE.MeshPhongMaterial({ 
                color: 0x888888,
                shininess: 30
            });
            
            for (let i = 0; i < 50; i++) {
                const asteroid = new THREE.Mesh(asteroidGeometry, asteroidMaterial);
                
                // Random position
                asteroid.position.x = (Math.random() - 0.5) * 200;
                asteroid.position.y = (Math.random() - 0.5) * 100;
                asteroid.position.z = (Math.random() - 0.5) * 200;
                
                // Random rotation
                asteroid.rotation.x = Math.random() * Math.PI;
                asteroid.rotation.y = Math.random() * Math.PI;
                
                // Random scale
                const scale = 0.5 + Math.random() * 2;
                asteroid.scale.set(scale, scale, scale);
                
                asteroid.castShadow = true;
                asteroid.receiveShadow = true;
                
                scene.add(asteroid);
                asteroids.push(asteroid);
            }
        }
        
        // Create crystals
        function createCrystals() {
            const crystalGeometry = new THREE.OctahedronGeometry(1, 0);
            
            for (let i = 0; i < totalCrystals; i++) {
                const crystalMaterial = new THREE.MeshPhongMaterial({ 
                    color: new THREE.Color(Math.random() * 0xffffff),
                    emissive: 0x4444ff,
                    shininess: 100,
                    transparent: true,
                    opacity: 0.8
                });
                
                const crystal = new THREE.Mesh(crystalGeometry, crystalMaterial);
                
                // Position crystals in different sectors
                crystal.position.x = (Math.random() - 0.5) * 100;
                crystal.position.y = (Math.random() - 0.5) * 50;
                crystal.position.z = (Math.random() - 0.5) * 100 - 50;
                
                crystal.castShadow = true;
                
                scene.add(crystal);
                crystals.push(crystal);
            }
        }
        
        // Create enemies
        function createEnemies() {
            const enemyGeometry = new THREE.ConeGeometry(0.8, 2, 6);
            const enemyMaterial = new THREE.MeshPhongMaterial({ 
                color: 0xff0000,
                emissive: 0x440000
            });
            
            for (let i = 0; i < 10; i++) {
                const enemy = new THREE.Mesh(enemyGeometry, enemyMaterial);
                
                // Position enemies
                enemy.position.x = (Math.random() - 0.5) * 150;
                enemy.position.y = (Math.random() - 0.5) * 50;
                enemy.position.z = (Math.random() - 0.5) * 150 - 100;
                
                enemy.rotation.x = Math.PI;
                enemy.castShadow = true;
                
                scene.add(enemy);
                enemies.push(enemy);
            }
        }
        
        // Handle window resize
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        // Start the game
        function startGame() {
            document.getElementById('startScreen').style.display = 'none';
            gameStarted = true;
            
            // Update character based on selection
            switch(selectedCharacter) {
                case 'rex':
                    ship.material.color.set(0xff5500);
                    ship.material.emissive.set(0x442200);
                    break;
                case 'nova':
                    ship.material.color.set(0x00ffaa);
                    ship.material.emissive.set(0x004422);
                    break;
                default: // zara
                    ship.material.color.set(0x00aaff);
                    ship.material.emissive.set(0x0044aa);
            }
        }
        
        // Restart the game
        function restartGame() {
            document.getElementById('missionComplete').style.display = 'none';
            collectedCrystals = 0;
            score = 0;
            health = 100;
            fuel = 100;
            updateUI();
            
            // Reset crystals
            crystals.forEach(crystal => {
                crystal.visible = true;
            });
            
            // Reset story
            document.getElementById('storyText').textContent = storySegments[0];
            
            // Reset ship position
            ship.position.set(0, 0, 0);
            
            gameStarted = true;
        }
        
        // Update UI elements
        function updateUI() {
            document.getElementById('health').textContent = `${health}%`;
            document.getElementById('fuel').textContent = `${fuel}%`;
            document.getElementById('score').textContent = score;
        }
        
        // Check collisions
        function checkCollisions() {
            // Check crystal collection
            crystals.forEach((crystal, index) => {
                if (crystal.visible) {
                    const distance = ship.position.distanceTo(crystal.position);
                    if (distance < 3) {
                        crystal.visible = false;
                        collectedCrystals++;
                        score += 1000;
                        
                        // Update story
                        if (collectedCrystals < storySegments.length) {
                            document.getElementById('storyText').textContent = storySegments[collectedCrystals];
                        }
                        
                        // Check mission complete
                        if (collectedCrystals >= totalCrystals) {
                            setTimeout(() => {
                                document.getElementById('missionComplete').style.display = 'flex';
                                gameStarted = false;
                            }, 2000);
                        }
                        
                        updateUI();
                    }
                }
            });
            
            // Check asteroid collisions
            asteroids.forEach(asteroid => {
                const distance = ship.position.distanceTo(asteroid.position);
                if (distance < 2) {
                    health -= 0.5;
                    updateUI();
                }
            });
            
            // Check enemy collisions
            enemies.forEach(enemy => {
                const distance = ship.position.distanceTo(enemy.position);
                if (distance < 2) {
                    health -= 1;
                    updateUI();
                }
            });
            
            // Check game over
            if (health <= 0) {
                alert("Mission Failed! Your ship has been destroyed.");
                restartGame();
            }
        }
        
        // Move enemies
        function moveEnemies() {
            enemies.forEach(enemy => {
                // Move towards player
                enemy.position.x += (ship.position.x - enemy.position.x) * 0.01;
                enemy.position.y += (ship.position.y - enemy.position.y) * 0.01;
                enemy.position.z += (ship.position.z - enemy.position.z) * 0.01;
                
                // Rotate to face player
                enemy.lookAt(ship.position);
            });
        }
        
        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            
            if (gameStarted) {
                // Handle ship movement
                const speed = keys['shift'] ? 0.3 : 0.15;
                
                if (keys['w']) ship.position.z -= speed;
                if (keys['s']) ship.position.z += speed;
                if (keys['a']) ship.position.x -= speed;
                if (keys['d']) ship.position.x += speed;
                
                // Rotate ship with mouse
                ship.rotation.y = (mouseX * Math.PI) / 180;
                ship.rotation.x = (mouseY * Math.PI) / 180;
                
                // Rotate crystals
                crystals.forEach(crystal => {
                    if (crystal.visible) {
                        crystal.rotation.x += 0.01;
                        crystal.rotation.y += 0.02;
                    }
                });
                
                // Rotate asteroids
                asteroids.forEach(asteroid => {
                    asteroid.rotation.x += 0.005;
                    asteroid.rotation.y += 0.005;
                });
                
                // Move enemies
                moveEnemies();
                
                // Check collisions
                checkCollisions();
                
                // Consume fuel
                fuel -= 0.01;
                if (fuel < 0) fuel = 0;
                updateUI();
                
                // Move camera to follow ship
                camera.position.x = ship.position.x;
                camera.position.y = ship.position.y + 5;
                camera.position.z = ship.position.z + 15;
                camera.lookAt(ship.position.x, ship.position.y, ship.position.z);
            }
            
            renderer.render(scene, camera);
        }
        
        // Mouse movement for ship rotation
        let mouseX = 0;
        let mouseY = 0;
        
        document.addEventListener('mousemove', (event) => {
            mouseX = (event.clientX / window.innerWidth) * 2 - 1;
            mouseY = (event.clientY / window.innerHeight) * 2 - 1;
        });
        
        // Initialize the game when the page loads
        window.onload = init;
    </script>
</body>
</html>
